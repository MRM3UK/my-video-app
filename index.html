<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PREMEO Ultra Pro V6.2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #05070a;
            --surface: #121826;
            --accent: #00f2ff;
            --text: #ffffff;
            --text-dim: #94a3b8;
            --glass: rgba(255, 255, 255, 0.05);
            --grad: linear-gradient(135deg, #00f2ff 0%, #0062ff 100%);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow-x: hidden; padding-bottom: 80px; }
        
        #loader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .spinner { width: 50px; height: 50px; border: 3px solid var(--glass); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .glass-header { position: sticky; top: 0; z-index: 100; background: rgba(5, 7, 10, 0.9); backdrop-filter: blur(20px); padding: 15px; border-bottom: 1px solid var(--glass); }
        .search-container { display: flex; gap: 10px; margin-top: 15px; background: var(--surface); padding: 12px 15px; border-radius: 12px; border: 1px solid var(--glass); }
        .search-container input { background: transparent; border: none; color: white; flex: 1; }
        
        .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; padding: 15px; }
        .m-card { position: relative; border-radius: 12px; overflow: hidden; background: var(--surface); transition: transform 0.2s; cursor: pointer; }
        .m-card:active { transform: scale(0.95); }
        .m-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; display: block; }
        .m-card .info { padding: 8px; font-size: 11px; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); position: absolute; bottom: 0; width: 100%; }
        
        /* Action Overlay for Library Cards */
        .card-actions { position: absolute; top: 5px; right: 5px; display: flex; gap: 5px; }
        .mini-btn { background: rgba(0,0,0,0.7); border: 1px solid var(--glass); color: white; width: 28px; height: 28px; border-radius: 6px; font-size: 10px; display: flex; align-items: center; justify-content: center; }

        .full-modal { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; overflow-y: auto; padding-bottom: 40px; }
        .cast-scroll { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .cast-item { flex: 0 0 80px; text-align: center; cursor: pointer; }
        .cast-item img { width: 65px; height: 65px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); margin-bottom: 5px; }
        
        .asset-btn { background: var(--surface); color: var(--text); border: 1px solid var(--glass); padding: 8px 12px; border-radius: 8px; font-size: 11px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .meta-pill { background: var(--glass); padding: 4px 10px; border-radius: 6px; font-size: 11px; margin-right: 5px; color: var(--accent); }
        
        .popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .popup-card { background: var(--surface); width: 100%; max-width: 400px; border-radius: 20px; padding: 25px; border: 1px solid var(--accent); overflow-y: auto; max-height: 90vh; }
        .popup-card input { width: 100%; background: #0a0f1a; border: 1px solid var(--glass); color: white; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        
        .action-btn { background: var(--grad); border: none; color: white; padding: 14px; border-radius: 12px; font-weight: bold; display: flex; align-items: center; gap: 8px; width: 100%; justify-content: center; cursor: pointer; }
        nav.bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: rgba(10, 15, 25, 0.95); display: flex; align-items: center; border-top: 1px solid var(--glass); z-index: 1000; }
        .nav-item { text-align: center; color: var(--text-dim); flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .toast { position: fixed; bottom: 85px; left: 50%; transform: translateX(-50%); background: var(--accent); color: #000; padding: 10px 20px; border-radius: 30px; font-weight: bold; z-index: 4000; display: none; }
        
        .filmo-tabs { display: flex; gap: 10px; margin: 15px 0; border-bottom: 1px solid var(--glass); padding-bottom: 10px; }
        .tab { color: var(--text-dim); font-size: 14px; cursor: pointer; padding: 5px 10px; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>

    <header class="glass-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="margin:0; font-size: 24px;">PREMEO<span style="color:var(--accent)">.</span></h1>
            <i class="fa-solid fa-circle-user" style="font-size: 24px; color: var(--text-dim)"></i>
        </div>
        <div class="search-container">
            <i class="fa-solid fa-magnifying-glass" style="color: var(--text-dim)"></i>
            <input type="text" id="mainSearch" placeholder="Search movies, actors..." onkeyup="if(event.key==='Enter') performSearch(this.value)">
        </div>
    </header>

    <main id="app-content">
        <div id="search-section" style="display:none">
            <div style="padding:15px 15px 0; display:flex; justify-content:space-between; align-items: center;">
                <h3 style="margin:0; color:var(--accent)">Results</h3>
                <span onclick="closeSearch()" style="background:var(--glass); padding:5px 12px; border-radius:15px; font-size:12px">Close X</span>
            </div>
            <div id="searchGrid" class="content-grid"></div>
        </div>

        <div id="trending-section">
            <div style="padding:15px 15px 0"><h3 style="margin:0">Trending Today</h3></div>
            <div id="mainGrid" class="content-grid"></div>
        </div>

        <div id="library-section">
            <div style="padding:15px 15px 0"><h3 style="margin:0">My Saved Library</h3></div>
            <div id="libraryGrid" class="content-grid"></div>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home', this)"><i class="fa-solid fa-house"></i><span>Home</span></div>
        <div class="nav-item" onclick="navTo('library', this)"><i class="fa-solid fa-clapperboard"></i><span>Library</span></div>
    </nav>

    <div id="detailsModal" class="full-modal"></div>

    <div id="libPopup" class="popup-overlay">
        <div class="popup-card">
            <h2 id="popTitle" style="margin:0 0 15px 0">Advanced Save</h2>
            <input type="hidden" id="edit-idx">
            <input type="text" id="lib-url" placeholder="Main Stream Link (Required)">
            <input type="text" id="lib-ep-url" placeholder="Direct Episode Link (Optional)">
            <input type="text" id="lib-size" placeholder="File Size (e.g. 1.2 GB)">
            <input type="text" id="lib-qual" placeholder="Quality (e.g. 4K, 1080p)">
            <input type="text" id="lib-cat" placeholder="Category (Action, Horror, etc.)">
            <div id="series-inputs" style="display:none; grid-template-columns:1fr 1fr; gap:10px">
                <input type="number" id="lib-s" placeholder="Season">
                <input type="number" id="lib-e" placeholder="Episode">
            </div>
            <button class="action-btn" id="saveBtn" onclick="saveToLibrary()">Save Item</button>
            <button onclick="document.getElementById('libPopup').style.display='none'" style="width:100%; background:none; border:none; color:white; opacity:0.5; margin-top:10px">Cancel</button>
        </div>
    </div>

    <div id="globalToast" class="toast"></div>

    <script>
        const API_KEY = "88649105198c3eecb4d2d6091d7ce972";
        const IMG = "https://image.tmdb.org/t/p/w500";
        const ORIG = "https://image.tmdb.org/t/p/original";
        let db = JSON.parse(localStorage.getItem('premeo_v6_2')) || { lib: [] };
        let tempItem = null;
        let navStack = [];

        window.onload = () => { 
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
            }, 800);
            fetchTrending(); 
            renderLibrary(); 
        };

        async function fetchTrending() {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${API_KEY}`);
            const data = await res.json();
            renderGrid(data.results, 'mainGrid');
        }

        async function performSearch(q) {
            if(!q) return;
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
            const data = await res.json();
            document.getElementById('search-section').style.display = 'block';
            renderGrid(data.results.filter(i => i.poster_path || i.profile_path), 'searchGrid');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function renderGrid(items, targetId) {
            document.getElementById(targetId).innerHTML = items.map(i => `
                <div class="m-card" onclick="openDetails('${i.media_type || (i.title ? 'movie' : 'tv')}', ${i.id})">
                    <img src="${IMG + (i.poster_path || i.profile_path)}" loading="lazy">
                    <div class="info">${i.title || i.name}</div>
                </div>
            `).join('');
        }

        async function openDetails(type, id, pushToStack = true) {
            if(type === 'person') return showPersonDetails(id);
            if(pushToStack && document.getElementById('detailsModal').style.display === 'block') {
                navStack.push(document.getElementById('detailsModal').innerHTML);
            }

            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&append_to_response=credits`);
            const d = await res.json();
            tempItem = { id: d.id, type, title: d.title || d.name, poster: d.poster_path, backdrop: d.backdrop_path, date: d.release_date || d.first_air_date, rating: d.vote_average, genres: d.genres.map(g => g.name).join(', ') };
            
            const modal = document.getElementById('detailsModal');
            modal.style.display = 'block';
            modal.scrollTo(0,0);
            modal.innerHTML = `
                <div style="position:relative">
                    <img src="${ORIG + (d.backdrop_path || d.poster_path)}" style="width:100%">
                    <button onclick="goBack()" style="position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.6); color:white; border:none; width:40px; height:40px; border-radius:50%"><i class="fa-solid fa-arrow-left"></i></button>
                </div>
                <div style="padding:20px">
                    <h1 style="margin:0">${d.title || d.name}</h1>
                    <div style="margin:10px 0; display:flex; flex-wrap:wrap; gap:5px">
                        <span class="meta-pill">‚≠ê ${d.vote_average.toFixed(1)}</span>
                        <span class="meta-pill">${d.runtime || d.episode_run_time?.[0] || '?'} min</span>
                        <span class="meta-pill">${tempItem.date}</span>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:15px 0">
                        <button class="action-btn" onclick="openLibPopup('${type}')"><i class="fa-solid fa-plus"></i> ADD TO LIB</button>
                        <button class="action-btn" style="background:#25d366" onclick="copySocialPost()"><i class="fa-solid fa-share-nodes"></i> AUTO POST</button>
                    </div>

                    <div style="display:flex; gap:8px; margin-bottom:20px; overflow-x:auto; padding-bottom:10px">
                        <button class="asset-btn" onclick="copyTxt('${ORIG+d.poster_path}')"><i class="fa-solid fa-link"></i> Copy Poster</button>
                        <button class="asset-btn" onclick="copyTxt('${ORIG+d.backdrop_path}')"><i class="fa-solid fa-image"></i> Copy Backdrop</button>
                        <button class="asset-btn" onclick="copyTxt('${d.title || d.name}')"><i class="fa-solid fa-font"></i> Copy Title</button>
                    </div>

                    <h3>Cast Members</h3>
                    <div class="cast-scroll">
                        ${d.credits.cast.slice(0,15).map(c => `
                            <div class="cast-item" onclick="showPersonDetails(${c.id})">
                                <img src="${c.profile_path ? IMG+c.profile_path : 'https://via.placeholder.com/65'}">
                                <span style="font-size:11px; font-weight:bold">${c.name}</span>
                            </div>
                        `).join('')}
                    </div>

                    <h3>Overview</h3>
                    <p style="color:var(--text-dim); line-height:1.6; font-size:14px">${d.overview}</p>
                </div>`;
        }

        async function showPersonDetails(id) {
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader').style.opacity = '1';
            
            const res = await fetch(`https://api.themoviedb.org/3/person/${id}?api_key=${API_KEY}&append_to_response=combined_credits`);
            const p = await res.json();
            
            const modal = document.getElementById('detailsModal');
            modal.style.display = 'block';
            modal.scrollTo(0,0);
            
            const movies = p.combined_credits.cast.filter(i => i.media_type === 'movie').sort((a,b) => (b.release_date || '0').localeCompare(a.release_date || '0'));
            const tv = p.combined_credits.cast.filter(i => i.media_type === 'tv').sort((a,b) => (b.first_air_date || '0').localeCompare(a.first_air_date || '0'));

            modal.innerHTML = `
                <div style="padding:20px">
                    <button onclick="goBack()" style="background:var(--surface); border:none; color:white; padding:10px 15px; border-radius:10px; margin-bottom:15px"><i class="fa-solid fa-chevron-left"></i> Back</button>
                    <div style="display:flex; gap:20px; align-items:center">
                        <img src="${IMG + p.profile_path}" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid var(--accent)">
                        <div><h2 style="margin:0">${p.name}</h2><p style="color:var(--accent)">${p.known_for_department}</p></div>
                    </div>
                    <p style="font-size:13px; color:var(--text-dim); margin-top:15px">${p.biography ? p.biography.substring(0,300)+'...' : 'No bio available.'}</p>
                    
                    <div class="filmo-tabs">
                        <div class="tab active" onclick="switchFilmo('movie', this)">Movies (${movies.length})</div>
                        <div class="tab" onclick="switchFilmo('tv', this)">TV Shows (${tv.length})</div>
                    </div>

                    <div id="filmo-content" class="content-grid" style="padding:0">
                        ${movies.filter(i => i.poster_path).map(i => `
                            <div class="m-card" onclick="openDetails('movie', ${i.id})">
                                <img src="${IMG + i.poster_path}">
                                <div class="info">${i.title}<br><span style="font-size:8px; opacity:0.7">${(i.release_date || '').substring(0,4)}</span></div>
                            </div>`).join('')}
                    </div>
                </div>`;
            
            window.currentFilmo = { movies, tv };
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
        }

        function switchFilmo(type, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            const data = type === 'movie' ? window.currentFilmo.movies : window.currentFilmo.tv;
            document.getElementById('filmo-content').innerHTML = data.filter(i => i.poster_path).map(i => `
                <div class="m-card" onclick="openDetails('${type}', ${i.id})">
                    <img src="${IMG + i.poster_path}">
                    <div class="info">${i.title || i.name}<br><span style="font-size:8px; opacity:0.7">${(i.release_date || i.first_air_date || '').substring(0,4)}</span></div>
                </div>`).join('');
        }

        function openLibPopup(type, editIdx = -1) {
            const isEdit = editIdx > -1;
            const popup = document.getElementById('libPopup');
            popup.style.display = 'flex';
            document.getElementById('popTitle').innerText = isEdit ? "Edit Item" : "Advanced Save";
            document.getElementById('edit-idx').value = editIdx;
            
            if(isEdit) {
                const item = db.lib[editIdx];
                document.getElementById('lib-url').value = item.url;
                document.getElementById('lib-ep-url').value = item.epUrl;
                document.getElementById('lib-size').value = item.size;
                document.getElementById('lib-qual').value = item.qual;
                document.getElementById('lib-cat').value = item.cat;
                document.getElementById('lib-s').value = item.s;
                document.getElementById('lib-e').value = item.e;
                document.getElementById('series-inputs').style.display = (item.type === 'tv' ? 'grid' : 'none');
            } else {
                ['lib-url','lib-ep-url','lib-size','lib-qual','lib-cat','lib-s','lib-e'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('series-inputs').style.display = (type === 'tv' ? 'grid' : 'none');
            }
        }

        function saveToLibrary() {
            const url = document.getElementById('lib-url').value;
            if(!url) return showToast("Stream Link is required!");
            
            const editIdx = parseInt(document.getElementById('edit-idx').value);
            const item = { 
                ...(editIdx > -1 ? db.lib[editIdx] : tempItem), 
                url, 
                epUrl: document.getElementById('lib-ep-url').value, 
                size: document.getElementById('lib-size').value, 
                qual: document.getElementById('lib-qual').value, 
                cat: document.getElementById('lib-cat').value,
                s: document.getElementById('lib-s').value, 
                e: document.getElementById('lib-e').value, 
                savedOn: new Date().toLocaleDateString() 
            };

            if(editIdx > -1) db.lib[editIdx] = item;
            else db.lib.unshift(item);

            localStorage.setItem('premeo_v6_2', JSON.stringify(db));
            renderLibrary();
            document.getElementById('libPopup').style.display = 'none';
            showToast(editIdx > -1 ? "Updated!" : "Saved!");
        }

        function deleteItem(idx, e) {
            e.stopPropagation();
            if(confirm("Delete this item?")) {
                db.lib.splice(idx, 1);
                localStorage.setItem('premeo_v6_2', JSON.stringify(db));
                renderLibrary();
            }
        }

        function renderLibrary() {
            const grid = document.getElementById('libraryGrid');
            if(db.lib.length === 0) { grid.innerHTML = '<p style="grid-column:1/-1; text-align:center; opacity:0.3; padding:40px">No items saved yet.</p>'; return; }
            grid.innerHTML = db.lib.map((i, index) => `
                <div class="m-card">
                    <img src="${IMG + i.poster}" onclick="playLibrary(${index})">
                    <div class="card-actions">
                        <button class="mini-btn" onclick="openLibPopup('${i.type}', ${index})"><i class="fa-solid fa-pen"></i></button>
                        <button class="mini-btn" style="color:#ff4d4d" onclick="deleteItem(${index}, event)"><i class="fa-solid fa-trash"></i></button>
                    </div>
                    <div class="info" onclick="playLibrary(${index})">
                        ${i.type === 'tv' ? `S${i.s} E${i.e} | ` : ''}${i.title}
                        <div style="font-size:9px; color:var(--accent)">${i.qual || 'HD'} ‚Ä¢ ${i.size || 'N/A'}</div>
                    </div>
                </div>`).join('');
        }

        async function playLibrary(idx) {
            const i = db.lib[idx];
            const modal = document.getElementById('detailsModal');
            modal.style.display = 'block';
            modal.scrollTo(0,0);
            
            // Show Player + Saved details first
            modal.innerHTML = `
                <div style="width:100%; aspect-ratio:16/9; background:#000; position:sticky; top:0; z-index:10">
                    <video id="v" controls autoplay style="width:100%; height:100%"></video>
                    <button onclick="closeModal()" style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); border:none; padding:5px 10px; border-radius:5px">Exit</button>
                </div>
                <div style="padding:20px" id="player-details">
                    <h2 style="margin:0">${i.title}</h2>
                    <p style="color:var(--accent); font-size:12px; margin:5px 0 15px">Saved on ${i.savedOn}</p>
                    <div style="background:var(--surface); padding:15px; border-radius:12px; font-size:13px; border:1px solid var(--glass); margin-bottom:20px">
                        <p><b>Link:</b> <span style="font-size:10px; color:var(--accent)">${i.url}</span></p>
                        <p><b>Details:</b> ${i.qual || 'HD'} ‚Ä¢ ${i.size || 'N/A'} ‚Ä¢ ${i.cat || 'General'}</p>
                    </div>
                    <div id="tmdb-live-details" style="opacity:0.6">Loading TMDB Sync...</div>
                </div>`;

            const v = document.getElementById('v');
            const p = new shaka.Player(v);
            p.load(i.url).catch(() => v.src = i.url);

            // Fetch live TMDB details alongside
            const res = await fetch(`https://api.themoviedb.org/3/${i.type}/${i.id}?api_key=${API_KEY}&append_to_response=credits`);
            const d = await res.json();
            document.getElementById('tmdb-live-details').innerHTML = `
                <hr style="border:0; border-top:1px solid var(--glass); margin:20px 0">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <h3>TMDB Overview</h3>
                    <span class="meta-pill">‚≠ê ${d.vote_average.toFixed(1)}</span>
                </div>
                <p style="font-size:13px; color:var(--text-dim); line-height:1.5">${d.overview}</p>
                <h3>Cast</h3>
                <div class="cast-scroll">
                    ${d.credits.cast.slice(0,8).map(c => `<div class="cast-item"><img src="${IMG+c.profile_path}"><span style="font-size:10px">${c.name}</span></div>`).join('')}
                </div>`;
            document.getElementById('tmdb-live-details').style.opacity = "1";
        }

        function copyTxt(t, m = "Copied!") { navigator.clipboard.writeText(t); showToast(m); }
        function goBack() { if(navStack.length > 0) { document.getElementById('detailsModal').innerHTML = navStack.pop(); } else { closeModal(); } }
        function navTo(p, el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(p === 'library') document.getElementById('library-section').scrollIntoView({behavior:'smooth'});
            else window.scrollTo({top:0, behavior:'smooth'});
        }
        function closeSearch() { document.getElementById('search-section').style.display='none'; document.getElementById('mainSearch').value=''; }
        function closeModal() { document.getElementById('detailsModal').style.display = 'none'; navStack = []; }
        function showToast(m) { const t=document.getElementById('globalToast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 2000); }
        function copySocialPost() {
            const post = `üé¨ DETAILS  [PMDB][PM\n\nüìå Title: ${tempItem.title}\nüìÖ Released: ${tempItem.date}\n‚≠ê Rating: ${tempItem.rating.toFixed(1)}/10\nüé≠ Genres: ${tempItem.genres}\n\nüñºÔ∏è Poster: ${ORIG + tempItem.poster}\n\nüì∫ STREAM LINK: [Insert Link Here]\n\n#Premeo #MovieApp #Streaming`;
            copyTxt(post, "Full Social Post Copied!");
        }
    </script>
</body>
</html>
